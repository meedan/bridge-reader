<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Bridgembed</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2015-05-06T15:56:26-03:00">2015-05-06T15:56:26-03:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         36.28
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>7</b> files in total.
    <b>293</b> relevant lines. 
    <span class="green"><b>293</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#35abb7809ebeab7c0388667115bbe464c4b25d60" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6a39daa1be193c23afc6d0591edd8e8114a8c118" class="src_link" title="app/controllers/medias_controller.rb">app/controllers/medias_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>123</td>
        <td>69</td>
        <td>69</td>
        <td>0</td>
        <td>6.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#255d8734f1b7ebd54e643d07715d4e7a73386401" class="src_link" title="app/helpers/medias_helper.rb">app/helpers/medias_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>18.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8e3e4bf48032d2f0357011e60b97e48eb680fe26" class="src_link" title="lib/bridge_embedly.rb">lib/bridge_embedly.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>124</td>
        <td>81</td>
        <td>81</td>
        <td>0</td>
        <td>25.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#355c824cd93e6e09a323c34f340a7ece563928ae" class="src_link" title="lib/bridge_error_codes.rb">lib/bridge_error_codes.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#561d67b4e272c36278e02679dd436234cf73e91e" class="src_link" title="lib/bridge_google_spreadsheet.rb">lib/bridge_google_spreadsheet.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>155</td>
        <td>86</td>
        <td>86</td>
        <td>0</td>
        <td>81.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#208135f9268dfd1af0b59d06891ddbf351a93f59" class="src_link" title="lib/bridge_watchbot.rb">lib/bridge_watchbot.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>32.0</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         6.07
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>2</b> files in total.
    <b>77</b> relevant lines. 
    <span class="green"><b>77</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#35abb7809ebeab7c0388667115bbe464c4b25d60" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6a39daa1be193c23afc6d0591edd8e8114a8c118" class="src_link" title="app/controllers/medias_controller.rb">app/controllers/medias_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>123</td>
        <td>69</td>
        <td>69</td>
        <td>0</td>
        <td>6.6</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         18.8
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>1</b> files in total.
    <b>23</b> relevant lines. 
    <span class="green"><b>23</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#255d8734f1b7ebd54e643d07715d4e7a73386401" class="src_link" title="app/helpers/medias_helper.rb">app/helpers/medias_helper.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>18.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         50.42
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>4</b> files in total.
    <b>193</b> relevant lines. 
    <span class="green"><b>193</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#8e3e4bf48032d2f0357011e60b97e48eb680fe26" class="src_link" title="lib/bridge_embedly.rb">lib/bridge_embedly.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>124</td>
        <td>81</td>
        <td>81</td>
        <td>0</td>
        <td>25.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#355c824cd93e6e09a323c34f340a7ece563928ae" class="src_link" title="lib/bridge_error_codes.rb">lib/bridge_error_codes.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#561d67b4e272c36278e02679dd436234cf73e91e" class="src_link" title="lib/bridge_google_spreadsheet.rb">lib/bridge_google_spreadsheet.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>155</td>
        <td>86</td>
        <td>86</td>
        <td>0</td>
        <td>81.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#208135f9268dfd1af0b59d06891ddbf351a93f59" class="src_link" title="lib/bridge_watchbot.rb">lib/bridge_watchbot.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>32.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.10.0 
        and simplecov-html v0.10.0<br/>
        using Unit Tests
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="35abb7809ebeab7c0388667115bbe464c4b25d60">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # Prevent CSRF attacks by raising an exception.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  # For APIs, you may want to use :null_session instead.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery with: :null_session</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_success</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    json = { type: &#39;success&#39; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    render json: json, status: 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_error(message, code, status = 400)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="14">
          <span class="hits">5</span>
          
          <code class="ruby">    render json: { type: &#39;error&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">      data: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        message: message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">        code: Bridge::ErrorCodes::const_get(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    status: status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6a39daa1be193c23afc6d0591edd8e8114a8c118">
  <div class="header">
    <h3>app/controllers/medias_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>69</b> relevant lines. 
      <span class="green"><b>69</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_google_spreadsheet&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_embedly&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_cache&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_error_codes&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">class MediasController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  include Bridge::Cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  after_action :allow_iframe, only: :embed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :get_host</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  before_filter :get_params, only: :embed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  TYPES = [&#39;milestone&#39;, &#39;link&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def all</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    @spreadsheet = Bridge::GoogleSpreadsheet.new(BRIDGE_CONFIG[&#39;google_email&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                                                 BRIDGE_CONFIG[&#39;google_password&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">                                                 BRIDGE_CONFIG[&#39;google_spreadsheet_id&#39;])</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    @worksheets = @spreadsheet.get_worksheets</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  def embed</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="23">
          <span class="hits">22</span>
          
          <code class="ruby">    render_error(&#39;Type not supported&#39;, &#39;INVALID_TYPE&#39;) and return if @type.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="25">
          <span class="hits">20</span>
          
          <code class="ruby">    respond_to do |format|</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="26">
          <span class="hits">31</span>
          
          <code class="ruby">      format.html { render_embed_as_html           }</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="27">
          <span class="hits">23</span>
          
          <code class="ruby">      format.js   { render_embed_as_js             }</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="28">
          <span class="hits">26</span>
          
          <code class="ruby">      format.png  { render_embed_as_png and return }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def notify</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="34">
          <span class="hits">3</span>
          
          <code class="ruby">      payload = request.raw_post</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">      if verify_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">        parse_notification(payload)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">        render_success</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">        render_error &#39;Signature could not be verified&#39;, &#39;INVALID_SIGNATURE&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    rescue Exception =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      render_error e.message, &#39;EXCEPTION&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_embed_as_png</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="49">
          <span class="hits">6</span>
          
          <code class="ruby">    render_error(&#39;Link is mandatory&#39;, &#39;PARAMETERS_MISSING&#39;) and return unless @type == &#39;link&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">    css = URI.parse(params[:css].to_s).to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">    @image = generate_screenshot(@type, @id, css)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">    send_data File.read(@image), type: &#39;image/png&#39;, disposition: &#39;inline&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_embed_as_js</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="58">
          <span class="hits">3</span>
          
          <code class="ruby">    @caller = request.original_url</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="59">
          <span class="hits">3</span>
          
          <code class="ruby">    @url = @caller.gsub(/\.js$/, &#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_embed_as_html</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="63">
          <span class="hits">11</span>
          
          <code class="ruby">    @cachepath = cache_path(@type, @id)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="64">
          <span class="hits">11</span>
          
          <code class="ruby">    if BRIDGE_CONFIG[&#39;cache_embeds&#39;] &amp;&amp; File.exists?(@cachepath)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      @cache = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="67">
          <span class="hits">10</span>
          
          <code class="ruby">      get_object</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="68">
          <span class="hits">10</span>
          
          <code class="ruby">      generate_cache(@object, @type, @id, @site)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="69">
          <span class="hits">10</span>
          
          <code class="ruby">      @cache = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="72">
          <span class="hits">11</span>
          
          <code class="ruby">    render text: File.read(@cachepath)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="75">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow_iframe</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="76">
          <span class="hits">22</span>
          
          <code class="ruby">    response.headers.except! &#39;X-Frame-Options&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def verify_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="80">
          <span class="hits">3</span>
          
          <code class="ruby">    signature = &#39;sha1=&#39; + OpenSSL::HMAC.hexdigest(OpenSSL::Digest.new(&#39;sha1&#39;), BRIDGE_CONFIG[&#39;secret_token&#39;].to_s, payload)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="81">
          <span class="hits">3</span>
          
          <code class="ruby">    Rack::Utils.secure_compare(signature, request.headers[&#39;X-Watchbot-Signature&#39;].to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_notification(payload)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">    notification = JSON.parse(payload)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="86">
          <span class="hits">1</span>
          
          <code class="ruby">    uri = URI.parse(Rack::Utils.unescape(notification[&#39;link&#39;]))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    link = uri.to_s.gsub(&#39;#&#39; + uri.fragment, &#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    @worksheet = Bridge::GoogleSpreadsheet.new(BRIDGE_CONFIG[&#39;google_email&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">                                               BRIDGE_CONFIG[&#39;google_password&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">                                               BRIDGE_CONFIG[&#39;google_spreadsheet_id&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">                                               uri.fragment)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="94">
          <span class="hits">1</span>
          
          <code class="ruby">    @worksheet.notify_link_condition(link, notification[&#39;condition&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_params</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="98">
          <span class="hits">22</span>
          
          <code class="ruby">    @type = (TYPES &amp; [params[:type].to_s]).first</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="99">
          <span class="hits">22</span>
          
          <code class="ruby">    @id = params[:id].to_s.gsub(/[^a-zA-Z0-9_-]/, &#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_object</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="103">
          <span class="hits">10</span>
          
          <code class="ruby">    case @type.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    when &#39;milestone&#39;</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="105">
          <span class="hits">7</span>
          
          <code class="ruby">      @object = Bridge::GoogleSpreadsheet.new(BRIDGE_CONFIG[&#39;google_email&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">                                              BRIDGE_CONFIG[&#39;google_password&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">                                              BRIDGE_CONFIG[&#39;google_spreadsheet_id&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">                                              @id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    when &#39;link&#39;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="110">
          <span class="hits">3</span>
          
          <code class="ruby">      @object = Bridge::GoogleSpreadsheet.new(BRIDGE_CONFIG[&#39;google_email&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">                                              BRIDGE_CONFIG[&#39;google_password&#39;],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">                                              BRIDGE_CONFIG[&#39;google_spreadsheet_id&#39;])</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="113">
          <span class="hits">3</span>
          
          <code class="ruby">      @link = @object.get_link(@id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="117">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_host</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="118">
          <span class="hits">26</span>
          
          <code class="ruby">    @host = request.host</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="119">
          <span class="hits">26</span>
          
          <code class="ruby">    @host_with_port = request.host_with_port</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="120">
          <span class="hits">26</span>
          
          <code class="ruby">    @protocol = request.protocol</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="121">
          <span class="hits">26</span>
          
          <code class="ruby">    @site = @protocol + @host_with_port</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="255d8734f1b7ebd54e643d07715d4e7a73386401">
  <div class="header">
    <h3>app/helpers/medias_helper.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MediasHelper</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby">  # From: https://github.com/twitter/twitter-text/blob/master/rb/lib/twitter-text/regex.rb</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  TWITTER_HASHTAG_ALPHA = /[\p{L}\p{M}]/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  TWITTER_HASHTAG_ALPHANUMERIC = /[\p{L}\p{M}\p{Nd}_\u200c\u0482\ua673\ua67e\u05be\u05f3\u05f4\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\u0f0d]/</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  TWITTER_HASHTAG_BOUNDARY = /\A|\z|[^&amp;\p{L}\p{M}\p{Nd}_\u200c\u0482\ua673\ua67e\u05be\u05f3\u05f4\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\u0f0d]/</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_text(text)</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="8">
          <span class="hits">57</span>
          
          <code class="ruby">    renderer = Redcarpet::Render::HTML.new(link_attributes: { target: &#39;_blank&#39; })</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="9">
          <span class="hits">57</span>
          
          <code class="ruby">    markdown = Redcarpet::Markdown.new(renderer, autolink: true)</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="10">
          <span class="hits">57</span>
          
          <code class="ruby">    text = markdown.render(text)</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="11">
          <span class="hits">57</span>
          
          <code class="ruby">    text.html_safe.chomp</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_translation(translation)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="15">
          <span class="hits">31</span>
          
          <code class="ruby">    provider, text = translation[:provider], translation[:translation]</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="16">
          <span class="hits">31</span>
          
          <code class="ruby">    text = self.send(&quot;#{provider}_parse_translation&quot;, text) if !provider.blank? &amp;&amp; self.respond_to?(&quot;#{provider}_parse_translation&quot;)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="17">
          <span class="hits">31</span>
          
          <code class="ruby">    text = parse_text(text)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="18">
          <span class="hits">31</span>
          
          <code class="ruby">    text.html_safe</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def twitter_parse_translation(text)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="22">
          <span class="hits">13</span>
          
          <code class="ruby">    text = text.gsub(/(#{TWITTER_HASHTAG_BOUNDARY})(#|＃)(#{TWITTER_HASHTAG_ALPHANUMERIC}*#{TWITTER_HASHTAG_ALPHA}#{TWITTER_HASHTAG_ALPHANUMERIC}*)/io, &#39;\1&lt;a href=&quot;https://twitter.com/hashtag/\3&quot; target=&quot;_blank&quot;&gt;\2\3&lt;/a&gt;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="23">
          <span class="hits">13</span>
          
          <code class="ruby">    text.gsub(/([@＠])([a-zA-Z0-9_]{1,20})/, &#39;&lt;a href=&quot;https://twitter.com/\2&quot; target=&quot;_blank&quot;&gt;\1\2&lt;/a&gt;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def instagram_parse_translation(text)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="27">
          <span class="hits">15</span>
          
          <code class="ruby">    text.gsub(/@([a-zA-Z0-9_]+)/, &#39;&lt;a href=&quot;http://instagram.com/\1&quot; target=&quot;_blank&quot;&gt;@\1&lt;/a&gt;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def include_twitter_tags_if_needed(entries, type, id, site)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="31">
          <span class="hits">21</span>
          
          <code class="ruby">    if entries.size == 1 &amp;&amp; type == &#39;link&#39;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="32">
          <span class="hits">5</span>
          
          <code class="ruby">      url = URI.join(site, &#39;medias/&#39;, &#39;embed/&#39;, type + &#39;/&#39;, &quot;#{id}.png&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      tag(:meta, name: &#39;twitter:card&#39;, content: &#39;photo&#39;) + &quot;\n&quot; +</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      tag(:meta, name: &#39;twitter:site&#39;, content: BRIDGE_CONFIG[&#39;twitter_handle&#39;]) + &quot;\n&quot; +</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="35">
          <span class="hits">5</span>
          
          <code class="ruby">      tag(:meta, name: &#39;twitter:image&#39;, content: url.to_s) + &quot;\n&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8e3e4bf48032d2f0357011e60b97e48eb680fe26">
  <div class="header">
    <h3>lib/bridge_embedly.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>81</b> relevant lines. 
      <span class="green"><b>81</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;embedly&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_cache&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_watchbot&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module Bridge</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class Embedly</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include Bridge::Cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(key)</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="11">
          <span class="hits">38</span>
          
          <code class="ruby">      connect_to_api(key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    def connect_to_api(key = &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="15">
          <span class="hits">92</span>
          
          <code class="ruby">      @api ||= ::Embedly::API.new(key: key, user_agent: &#39;Mozilla/5.0 (compatible; Bridge/1.0; bridge@meedanlabs.com)&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    def objects_from_urls(urls = [])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      @oembeds ||= connect_to_api.oembed(urls: urls).collect do |oembed|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">        oembed[:link] = oembed[:url]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">        function = &quot;alter_#{oembed.provider_name.underscore}_oembed&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">        (oembed = self.send(function, oembed)) if self.respond_to?(function)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">        oembed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    def call_oembed(link)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="28">
          <span class="hits">52</span>
          
          <code class="ruby">      oembed = {}</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="29">
          <span class="hits">52</span>
          
          <code class="ruby">      Retryable.retryable tries: 5, sleep: 3 do</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="30">
          <span class="hits">52</span>
          
          <code class="ruby">        oembed = connect_to_api.oembed(url: link).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="32">
          <span class="hits">52</span>
          
          <code class="ruby">      oembed[:link] = link</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="33">
          <span class="hits">52</span>
          
          <code class="ruby">      oembed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    def parse_entry(entry)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="37">
          <span class="hits">61</span>
          
          <code class="ruby">      Rails.cache.fetch(bridge_cache_key(entry)) do</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="38">
          <span class="hits">52</span>
          
          <code class="ruby">        link = entry[:link]</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="39">
          <span class="hits">52</span>
          
          <code class="ruby">        Rails.cache.delete_matched(/^#{link}:/)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="40">
          <span class="hits">52</span>
          
          <code class="ruby">        remove_embed_screenshot(entry)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="41">
          <span class="hits">52</span>
          
          <code class="ruby">        oembed = call_oembed(link)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="42">
          <span class="hits">52</span>
          
          <code class="ruby">        entry[:provider] = provider = oembed.provider_name.to_s.underscore</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="43">
          <span class="hits">52</span>
          
          <code class="ruby">        entry[:oembed] = self.alter_oembed(oembed, provider)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="44">
          <span class="hits">52</span>
          
          <code class="ruby">        entry[:oembed][&#39;unavailable&#39;] ? notify_unavailable(entry) : notify_available(entry)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="45">
          <span class="hits">52</span>
          
          <code class="ruby">        entry</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def remove_embed_screenshot(entry)</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="50">
          <span class="hits">53</span>
          
          <code class="ruby">      id = Digest::SHA1.hexdigest(entry[:link])</code>
        </li>
      
        <li class="covered" data-hits="53" data-linenumber="51">
          <span class="hits">53</span>
          
          <code class="ruby">      remove_screenshot(&#39;link&#39;, id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    def parse_entries(entries = [])</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="55">
          <span class="hits">28</span>
          
          <code class="ruby">      unless @entries</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="56">
          <span class="hits">28</span>
          
          <code class="ruby">        @entries = []</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="57">
          <span class="hits">28</span>
          
          <code class="ruby">        entries.each do |entry|</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="58">
          <span class="hits">59</span>
          
          <code class="ruby">          entry = parse_entry(entry)</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="59">
          <span class="hits">59</span>
          
          <code class="ruby">          @entries &lt;&lt; entry unless entry[:oembed][&#39;unavailable&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="62">
          <span class="hits">28</span>
          
          <code class="ruby">      @entries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">    def send_to_watchbot(entry)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="66">
          <span class="hits">31</span>
          
          <code class="ruby">      Bridge::Watchbot.new.send(entry[:link] + &#39;#&#39; + entry[:source].to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_available(entry)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="70">
          <span class="hits">30</span>
          
          <code class="ruby">      send_to_watchbot(entry)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="71">
          <span class="hits">30</span>
          
          <code class="ruby">      entry[:source].notify_availability(entry[:index], true) unless entry[:source].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_unavailable(entry)</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="75">
          <span class="hits">23</span>
          
          <code class="ruby">      entry[:source].notify_availability(entry[:index], false) unless entry[:source].nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    def alter_oembed(oembed, provider)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="79">
          <span class="hits">52</span>
          
          <code class="ruby">      function = &quot;alter_#{provider}_oembed&quot;</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="80">
          <span class="hits">52</span>
          
          <code class="ruby">      oembed[&#39;unavailable&#39;] = true if oembed.respond_to?(:error_code) &amp;&amp; oembed.error_code === 404</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="81">
          <span class="hits">52</span>
          
          <code class="ruby">      (oembed = self.send(function, oembed)) if self.respond_to?(function)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="82">
          <span class="hits">52</span>
          
          <code class="ruby">      oembed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    # Methods to alter responses for some providers</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">    def alter_twitter_oembed(oembed)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="88">
          <span class="hits">27</span>
          
          <code class="ruby">      require &#39;twitter&#39;</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="89">
          <span class="hits">27</span>
          
          <code class="ruby">      id = oembed[:link].match(/status\/([0-9]+)/)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="90">
          <span class="hits">27</span>
          
          <code class="ruby">      unless id.nil?</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="91">
          <span class="hits">26</span>
          
          <code class="ruby">        Retryable.retryable tries: 5, sleep: 3 do</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="92">
          <span class="hits">26</span>
          
          <code class="ruby">          begin</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="93">
          <span class="hits">26</span>
          
          <code class="ruby">            client = connect_to_twitter</code>
        </li>
      
        <li class="covered" data-hits="26" data-linenumber="94">
          <span class="hits">26</span>
          
          <code class="ruby">            tweet = client.status(id[1])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="95">
          <span class="hits">14</span>
          
          <code class="ruby">            geo = tweet.geo</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="96">
          <span class="hits">14</span>
          
          <code class="ruby">            oembed[&#39;coordinates&#39;] = [geo.latitude, geo.longitude] if tweet.geo?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="97">
          <span class="hits">14</span>
          
          <code class="ruby">            oembed[&#39;created_at&#39;] = tweet.created_at</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">          rescue Twitter::Error::NotFound, Twitter::Error::Forbidden</code>
        </li>
      
        <li class="covered" data-hits="12" data-linenumber="99">
          <span class="hits">12</span>
          
          <code class="ruby">            oembed[&#39;unavailable&#39;] = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="103">
          <span class="hits">27</span>
          
          <code class="ruby">      oembed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">    def connect_to_twitter</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="107">
          <span class="hits">27</span>
          
          <code class="ruby">      Twitter::REST::Client.new do |config|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="108">
          <span class="hits">27</span>
          
          <code class="ruby">        config.consumer_key        = BRIDGE_CONFIG[&#39;twitter_consumer_key&#39;]</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="109">
          <span class="hits">27</span>
          
          <code class="ruby">        config.consumer_secret     = BRIDGE_CONFIG[&#39;twitter_consumer_secret&#39;]</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="110">
          <span class="hits">27</span>
          
          <code class="ruby">        config.access_token        = BRIDGE_CONFIG[&#39;twitter_access_token&#39;]</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="111">
          <span class="hits">27</span>
          
          <code class="ruby">        config.access_token_secret = BRIDGE_CONFIG[&#39;twitter_access_token_secret&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">    def alter_instagram_oembed(oembed)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="116">
          <span class="hits">15</span>
          
          <code class="ruby">      uri = URI.parse(oembed[:link])</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="117">
          <span class="hits">15</span>
          
          <code class="ruby">      http = Net::HTTP.new(uri.host, uri.port)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="118">
          <span class="hits">15</span>
          
          <code class="ruby">      http.use_ssl = uri.scheme == &#39;https&#39;</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="119">
          <span class="hits">15</span>
          
          <code class="ruby">      result = http.get(uri.path)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="120">
          <span class="hits">15</span>
          
          <code class="ruby">      oembed[&#39;unavailable&#39;] = (result.code.to_i === 404)</code>
        </li>
      
        <li class="covered" data-hits="15" data-linenumber="121">
          <span class="hits">15</span>
          
          <code class="ruby">      oembed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="355c824cd93e6e09a323c34f340a7ece563928ae">
  <div class="header">
    <h3>lib/bridge_error_codes.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Bridge</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class ErrorCodes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    INVALID_SIGNATURE = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    EXCEPTION = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    PARAMETERS_MISSING = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    INVALID_TYPE = 4</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="561d67b4e272c36278e02679dd436234cf73e91e">
  <div class="header">
    <h3>lib/bridge_google_spreadsheet.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>86</b> relevant lines. 
      <span class="green"><b>86</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;google_drive&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_embedly&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_cache&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;bridge_watchbot&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">module Bridge</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class GoogleSpreadsheet</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    include Bridge::Cache</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(email, password, id, sheet = nil)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="11">
          <span class="hits">61</span>
          
          <code class="ruby">      @entries = []</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="12">
          <span class="hits">61</span>
          
          <code class="ruby">      authenticate(email, password)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="13">
          <span class="hits">61</span>
          
          <code class="ruby">      get_spreadsheet(id)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="14">
          <span class="hits">61</span>
          
          <code class="ruby">      sheet.nil? ? get_worksheets : get_worksheet(sheet)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def authenticate(email = &#39;&#39;, password = &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="123" data-linenumber="18">
          <span class="hits">123</span>
          
          <code class="ruby">      @session ||= GoogleDrive::Session.login(email, password)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_spreadsheet(id = &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="125" data-linenumber="22">
          <span class="hits">125</span>
          
          <code class="ruby">      @spreadsheet ||= authenticate.spreadsheet_by_key(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_title(title = &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="77" data-linenumber="26">
          <span class="hits">77</span>
          
          <code class="ruby">      @title ||= title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_worksheet(title = &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="290" data-linenumber="30">
          <span class="hits">290</span>
          
          <code class="ruby">      @worksheet ||= get_spreadsheet.worksheet_by_title(get_title(title))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_urls</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      unless @urls</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">        worksheet = get_worksheet</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        urls = []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">        # FIXME: Assuming that the first row is the header</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">        for row in 2..worksheet.num_rows</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">          # FIXME: Link column index is hard-coded here</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="40">
          <span class="hits">4</span>
          
          <code class="ruby">          Retryable.retryable tries: 5 do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="41">
          <span class="hits">4</span>
          
          <code class="ruby">            urls &lt;&lt; worksheet[row, 2]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">        @urls = urls</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      @urls</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_entries(link = nil, force = false)</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="50">
          <span class="hits">130</span>
          
          <code class="ruby">      if @entries.empty? || force</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="51">
          <span class="hits">111</span>
          
          <code class="ruby">        worksheet = get_worksheet</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="52">
          <span class="hits">111</span>
          
          <code class="ruby">        @entries = []</code>
        </li>
      
        <li class="covered" data-hits="111" data-linenumber="53">
          <span class="hits">111</span>
          
          <code class="ruby">        for row in 2..worksheet.num_rows</code>
        </li>
      
        <li class="covered" data-hits="2406" data-linenumber="54">
          <span class="hits">2406</span>
          
          <code class="ruby">          Retryable.retryable tries: 5 do</code>
        </li>
      
        <li class="covered" data-hits="2406" data-linenumber="55">
          <span class="hits">2406</span>
          
          <code class="ruby">            @entries &lt;&lt; row_to_hash(row) if link.nil? || link == Digest::SHA1.hexdigest(worksheet[row, 2])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="59">
          <span class="hits">130</span>
          
          <code class="ruby">      @entries</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_worksheets</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="63">
          <span class="hits">38</span>
          
          <code class="ruby">      @worksheets ||= get_spreadsheet.worksheets</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">    def get_link(hash)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="67">
          <span class="hits">8</span>
          
          <code class="ruby">      link = Rails.cache.fetch(hash) do</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="68">
          <span class="hits">7</span>
          
          <code class="ruby">        get_worksheets.each do |worksheet|</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="69">
          <span class="hits">88</span>
          
          <code class="ruby">          @worksheet = worksheet</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="70">
          <span class="hits">88</span>
          
          <code class="ruby">          get_entries(hash)</code>
        </li>
      
        <li class="covered" data-hits="88" data-linenumber="71">
          <span class="hits">88</span>
          
          <code class="ruby">          break unless @entries.empty? </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="73">
          <span class="hits">7</span>
          
          <code class="ruby">        @entries.empty? ? nil : { title: @worksheet.title, url: @entries[0][:link] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="76">
          <span class="hits">8</span>
          
          <code class="ruby">      unless link.nil?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="77">
          <span class="hits">6</span>
          
          <code class="ruby">        get_worksheet(link[:title])</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="78">
          <span class="hits">6</span>
          
          <code class="ruby">        get_entries(hash).first</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_availability(index, available)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      #FIXME: Cell position is hard-coded here</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="84">
          <span class="hits">49</span>
          
          <code class="ruby">      worksheet = get_worksheet</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="85">
          <span class="hits">49</span>
          
          <code class="ruby">      value = available ? &#39;No&#39; : &#39;Yes&#39;</code>
        </li>
      
        <li class="covered" data-hits="49" data-linenumber="86">
          <span class="hits">49</span>
          
          <code class="ruby">      unless worksheet[index, 9].to_s == value.to_s</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="87">
          <span class="hits">4</span>
          
          <code class="ruby">        worksheet[1, 9] = &#39;Unavailable?&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="88">
          <span class="hits">4</span>
          
          <code class="ruby">        worksheet[index, 9] = value</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="89">
          <span class="hits">4</span>
          
          <code class="ruby">        Retryable.retryable tries: 5 do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="90">
          <span class="hits">4</span>
          
          <code class="ruby">          worksheet.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">    def to_s</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="96">
          <span class="hits">24</span>
          
          <code class="ruby">      get_title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="99">
          <span class="hits">1</span>
          
          <code class="ruby">    def url</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="100">
          <span class="hits">20</span>
          
          <code class="ruby">      get_worksheet.spreadsheet.human_url + &#39;#&#39; + get_title</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">    def send_to_watchbot</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="104">
          <span class="hits">18</span>
          
          <code class="ruby">      Bridge::Watchbot.new.send(self.url)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_link_condition(link, condition)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="108">
          <span class="hits">3</span>
          
          <code class="ruby">      case condition</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">      when &#39;check404&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="110">
          <span class="hits">2</span>
          
          <code class="ruby">        notify_entry_offline(link)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">      when &#39;check_google_spreadsheet_updated&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">        notify_google_spreadsheet_updated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">    def row_to_hash(row)</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="119">
          <span class="hits">63</span>
          
          <code class="ruby">      worksheet = get_worksheet</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">      {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">        source_text: worksheet[row, 1],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">        link: worksheet[row, 2],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby">        translation: worksheet[row, 3],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">        comment: worksheet[row, 4],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">        translator_name: worksheet[row, 5],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">        translator_url: worksheet[row, 6],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">        commenter: worksheet[row, 7],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">        commenter_url: worksheet[row, 8],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby">        source: self,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        index: row</code>
        </li>
      
        <li class="covered" data-hits="63" data-linenumber="131">
          <span class="hits">63</span>
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_entry_offline(link)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="135">
          <span class="hits">2</span>
          
          <code class="ruby">      hash = Digest::SHA1.hexdigest(link)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="136">
          <span class="hits">2</span>
          
          <code class="ruby">      entry = self.get_entries(hash).first</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="137">
          <span class="hits">2</span>
          
          <code class="ruby">      return if entry.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="138">
          <span class="hits">2</span>
          
          <code class="ruby">      Rails.cache.write(bridge_cache_key(entry), entry.merge({ oembed: { &#39;unavailable&#39; =&gt; true }}))</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="139">
          <span class="hits">2</span>
          
          <code class="ruby">      notify_availability(entry[:index], false)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="140">
          <span class="hits">2</span>
          
          <code class="ruby">      generate_cache(self, &#39;milestone&#39;, self.get_worksheet.title)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="141">
          <span class="hits">2</span>
          
          <code class="ruby">      self.get_entries(hash, true)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="142">
          <span class="hits">2</span>
          
          <code class="ruby">      generate_cache(self, &#39;link&#39;, hash, BRIDGE_CONFIG[&#39;bridgembed_host&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify_google_spreadsheet_updated</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">      generate_cache(self, &#39;milestone&#39;, self.get_worksheet.title)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="148">
          <span class="hits">1</span>
          
          <code class="ruby">      self.get_entries.each do |entry|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="149">
          <span class="hits">4</span>
          
          <code class="ruby">        hash = Digest::SHA1.hexdigest(entry[:link])</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="150">
          <span class="hits">4</span>
          
          <code class="ruby">        self.get_entries(hash, true)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="151">
          <span class="hits">4</span>
          
          <code class="ruby">        generate_cache(self, &#39;link&#39;, hash, BRIDGE_CONFIG[&#39;bridgembed_host&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="208135f9268dfd1af0b59d06891ddbf351a93f59">
  <div class="header">
    <h3>lib/bridge_watchbot.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Bridge</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Watchbot</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">   </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="5">
          <span class="hits">52</span>
          
          <code class="ruby">      @url = BRIDGE_CONFIG[&#39;watchbot_url&#39;]</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="6">
          <span class="hits">52</span>
          
          <code class="ruby">      @uri = URI.parse(@url) unless @url.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    def send(link)</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="10">
          <span class="hits">50</span>
          
          <code class="ruby">      response = nil</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="11">
          <span class="hits">50</span>
          
          <code class="ruby">      if @url.blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">        Rails.logger.info &#39;Not sending to WatchBot because its URL is not set on the configuration file&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="14">
          <span class="hits">48</span>
          
          <code class="ruby">        response = self.request(link)</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="15">
          <span class="hits">48</span>
          
          <code class="ruby">        Rails.logger.info &#39;Sent to the WatchBot&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="50" data-linenumber="17">
          <span class="hits">50</span>
          
          <code class="ruby">      response</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    def request(link)</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="23">
          <span class="hits">47</span>
          
          <code class="ruby">      request = Net::HTTP::Post.new(@uri.path)</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="24">
          <span class="hits">47</span>
          
          <code class="ruby">      request.set_form_data({ url: link })</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="25">
          <span class="hits">47</span>
          
          <code class="ruby">      request[&#39;Authorization&#39;] = &#39;Token token=&#39; + BRIDGE_CONFIG[&#39;watchbot_token&#39;].to_s</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="26">
          <span class="hits">47</span>
          
          <code class="ruby">      http = Net::HTTP.new(@uri.hostname, @uri.port)</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="27">
          <span class="hits">47</span>
          
          <code class="ruby">      http.use_ssl = @uri.scheme == &#39;https&#39;</code>
        </li>
      
        <li class="covered" data-hits="47" data-linenumber="28">
          <span class="hits">47</span>
          
          <code class="ruby">      http.request(request)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
